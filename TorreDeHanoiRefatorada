public class TorreDeHanoiRefatorada {

    private static final int MIN_DISCS = 1;

    private final pilhaRefatorada torreA;
    private final pilhaRefatorada torreB;
    private final pilhaRefatorada torreC;

    private int movimentosRealizados = 0;

    public enum TorreID { A, B, C }

    public TorreDeHanoiRefatorada(int numDeDiscos) {
        if (numDeDiscos < MIN_DISCS) {
            throw new IllegalArgumentException("A quantidade de discos deve ser no mÃ­nimo 1.");
        }

        torreA = new pilhaRefatorada(numDeDiscos);
        torreB = new pilhaRefatorada(numDeDiscos);
        torreC = new pilhaRefatorada(numDeDiscos);

        inicializarTorres(numDeDiscos);
    }

    private void inicializarTorres(int numDeDiscos) {
        for (int i = numDeDiscos; i > 0; i--) {
            torreA.push(new discoRefatorado(i));
        }
    }

    public pilhaRefatorada getTorre(TorreID idTorre) {
        switch (idTorre) {
            case A: return torreA;
            case B: return torreB;
            case C: return torreC;
        }
        return null;
    }

    public boolean isVitoria() {
        return torreA.isEmpty() &&
                (torreB.isEmpty() || torreC.isEmpty());
    }

    public Integer moverDisco(TorreID origem, TorreID destino) {
        if (origem == destino) {
            return null;
        }

        pilhaRefatorada torreOrigem = getTorre(origem);
        pilhaRefatorada torreDestino = getTorre(destino);

        if (!movimentoPermitido(torreOrigem, torreDestino)) {
            return null;
        }

        discoRefatorado discoMovido = torreOrigem.pop();
        torreDestino.push(discoMovido);

        movimentosRealizados++;
        return movimentosRealizados;
    }

    private boolean movimentoPermitido(pilhaRefatorada torreOrigem, pilhaRefatorada torreDestino) {

        if (torreOrigem.isEmpty()) {
            return false;
        }

        discoRefatorado discoOrigem = torreOrigem.peek();
        discoRefatorado discoDestino = torreDestino.peek();

        return discoDestino == null ||
                discoOrigem.getTamanho() < discoDestino.getTamanho();
    }

    public int getMovimentosRealizados() {
        return movimentosRealizados;
    }
}
